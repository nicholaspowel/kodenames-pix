<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Kodenames Pix</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <style>
    img {
      border: solid;
      border-width: 5px;
      border-color: white;
    }
    body{
      margin: 0px;
    }
    #theTable{
      border: solid;
      border-color: red;
    }
    .blue{

      border: solid;
      border-color: blue;
      border-width: 5px;
    }

    .red {      
      border: solid;
      border-color: red;
      border-width: 5px;
    }
    .black {
      border: solid;
      border-color: black;
      border-width: 5px;
    }
    .yellow {
      border: solid;
      border-color: yellow;
      border-width: 5px;
    }
    .green {
      border: solid;
      border-color: green;
      border-width: 5px;
    }
  </style>
</head>

<body>
  <table id='theTable' style="width:100%">
  </table>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-48676831-8', 'auto');
    ga('send', 'pageview');

  </script>
  <script src="seedrandom.js"></script>
  <script>
    var spymaster = false;
    if(window.location.hash) {
      var hash = window.location.hash.substring(1).toLowerCase();
      if(hash.charAt(0) === '?'){
        hash = hash.substring(1);
        spymaster = true;
      } else {
        //do something
      }
      Math.seedrandom(hash);
    }
    var url = "https://unsplash.it/list";
    var arr = [];
    var json;
    $.getJSON(url, function (data) {
       json = data; 
    }).then(function(){
      while(arr.length < 25){
             var randomnumber=json[Math.floor((Math.random() * json.length))].id;
             var found=false;
             for(var i=0;i<arr.length;i++){
            if(arr[i]==randomnumber){found=true;break}
             }
             if(!found)arr[arr.length]=randomnumber;
      }
      var imgWidth = $(window).width() / 5.5;
      var imgHeight = $(window).height() / 5.5;
      for(var i = 0;i < 5; i++){
        $('#theTable').append('<tr id="row' + i + '""></tr>');
        for (var j = 0;j < 5; j++){
          $('#row' + i).append('<td><img src="https://unsplash.it/' + imgWidth + '/' + imgHeight + '?image=' + arr[((i*5) + j)] + '"></td>');
        }
      }
      var teams = [];
      //9 8 1 7     
      for(var i = 0;i<7;i++){
        teams.push('redSecret');
        teams.push('blueSecret');
        teams.push('yellowSecret');
      }
      teams.push('redSecret');
      teams.push('blueSecret');
      teams.push('blackSecret');
      //random starter team
      if(Math.floor((Math.random() * 2) + 1) % 2 === 0){
          teams.push('redSecret');
          //make border red
      } else {
        teams.push('blueSecret');
        $('#theTable').css('border-color', 'blue');
      }


      shuffle(teams);
      $( "img" ).each(function() {
        $(this).addClass(teams.pop());
      });

      $('img').bind('click', function(){
        if($(this).hasClass('redSecret')){
          $(this).addClass('red');
        } else if($(this).hasClass('blueSecret')){
          $(this).addClass('blue');
        } else if($(this).hasClass('yellowSecret')){
          $(this).addClass('yellow');
        } else if($(this).hasClass('blackSecret')){
          $(this).addClass('black');
        }  
      }); 
      if(spymaster){
        $('img').click();
        $('img').unbind().bind('click', function(){
          $(this).addClass('green');
        });
      } 
    });

    function shuffle(array) {
      var currentIndex = array.length, temporaryValue, randomIndex;

      // While there remain elements to shuffle...
      while (0 !== currentIndex) {

        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        // And swap it with the current element.
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
      }

      return array;
    }

  </script>

</body>
</html>
